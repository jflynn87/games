{%load static%}
{%load bootstrap%}
{%load compress%}
{%load golf_extras%}


{% block body_block %}
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
<h3 style="text-align: center;">Golf Game Weekly Recap</h3>
<p style="padding-left: 3em; padding-right: 3em;"> <img src="http://jflynn87.pythonanywhere.com/static/img/bigstock-Golf-ball-on-green-turf-banner-93044627.jpg" alt="" width="100%" height="25%"></p>

<p style="color:black; font-weight: bold; padding-left: 3em;">Congratualtions <span style="font-weight: bold;"> {% for w in last_t.winner%} {{w.user.username}} {%endfor%} </span> for winning the {{last_t.name}}</p>
<p style="color:black; font-weight: bold; padding-left: 3em">{{msg1}}</p>

<p style="color:black; font-weight: bold; padding-left: 3em">We are {{complete}} events through the season, with {{remaining}} remaining.</p>

<br>
<div style="padding-left: 3em; padding-right: 3em;">
<h5>Trends</h5>        
        <table class="table table-sm" style="border: 1px solid;">
            <thead style="background-color: lightgray;">
                <tr>
                <th style="border: 1px solid;"></th>
                {%for u, data in display_dict.user_data.items%}
                <th style="border: 1px solid;">{{u}}</th>
                {%endfor%}
            </tr>
            </thead>
            <tr>
                <td style="border: 1px solid;">Last 5 Trend</td>
                {%for u, data in display_dict.user_data.items%}
                        <td style="border: 1px solid;">{{data.trend.desc}}</td>
                {%endfor%}
            </tr>
            <tr>
                <td style="border: 1px solid;"><a href="https://en.wikipedia.org/wiki/Slope#:~:text=Slope%20is%20calculated%20by%20finding,points%20on%20the%20same%20line.">Slope</a></td>
                {%for u, data in display_dict.user_data.items%}
                        <td style="border: 1px solid;">{{data.trend.slope|floatformat:2}}</td>
                {%endfor%}
            </tr>
            <tr>
                <td style="border: 1px solid;"><a href="https://en.wikipedia.org/wiki/Root-mean-square_deviation">NRMSE</a></td>
                {%for u, data in display_dict.user_data.items%}
                        <td style="border: 1px solid;">{{data.trend.nrmse|floatformat:2}}</td>
                {%endfor%}
            </tr>
            <tr>
                <td style="border: 1px solid;">Points Behind</td>
                {%for u, data in display_dict.user_data.items%}
                        <td style="border: 1px solid;">{{data.trend.current}}</td>
                {%endfor%}
            </tr>
            <tr>
                <td style="border: 1px solid;">Vs. 3 weeks ago</td>
                {%for u, data in display_dict.user_data.items%}
                        <td style="border: 1px solid;">{{data.trend.three}}</td>
                {%endfor%}
            </tr>
            <tr>
                <td style="border: 1px solid;">Vs. 5 weeks ago</td>
                {%for u, data in display_dict.user_data.items%}
                        <td style="border: 1px solid;">{{data.trend.five}}</td>
                {%endfor%}
            </tr>

        </table>
        <h5>Notes:</h5>
        <ul>
        
        <li>Slope and NRMSE are based on the last 6 tournaments (including the current event)</li>
        <li>Points behind is based on the current total scores.  The 3 and 5 weeks ago numbers are comparing how far behind you are today vs. at those points in time.  A ngative number is bad, a positive is good.</li>
        </ul>
</div>      


<!-- <h3 style="text-align:center;">Score Summary {{fedex_season}}</h3> -->
<br>
<br>
<div class="row">

<div id="summary-section" class="col">
    <h5 style="text-align:center;">Summary Data</h5>
    <table id="summary-table" class="table table-sm" style="border: 1px solid;">
        <thead style="background-color: lightgray;">
            <tr>
                <th style="border: 1px solid;"></th>
                {%for k, v in display_dict.user_data.items%}
                    {%if k not in 'details, into_top30, out_top30'%}
                <th style="border: 1px solid;">{{k|slice:"0:4"}}</th>
                {%endif%}
                {%endfor%}
            </tr>
        </thead>

        <tr id="total_score_row" style="border: 1px solid;">
            <th style="text-align:left; border: 1px solid;">Season Total</th>
            {%for user, data in display_dict.user_data.items%}
                <td style="border: 1px solid;">{{data.total}}</td>
            {%endfor%}

        </tr> 
        <tr id="total_rank_row" style="border: 1px solid;">
            <th style="text-align:left; border: 1px solid;">Season Rank</th>
            {%for user, data in display_dict.user_data.items%}
                <td style="border: 1px solid;">{{data.rank}}</td>
                
            {%endfor%}
        </tr>
        <tr style="border: 1px solid;">
            <td colspan="12" style="background-color: lightblue;"></td>
        </tr>
        <tr id="fedex_total_row" style="border: 1px solid;">
            <th style="text-align:left; border: 1px solid;">FedEx Points</th>
            {%for user, data in display_dict.user_data.items%}
            <td style="border: 1px solid;">{{data.fed_ex_score}}</td>
            {%endfor%}
        </tr>
        <tr id="fedex_rank_row" style="border: 1px solid;">
            <th style="text-align:left; border: 1px solid;">Rank</th>
            {%for user, data in display_dict.user_data.items%}
            <td style="border: 1px solid;">{{data.fed_ex_rank}}</td>
            {%endfor%}

        </tr>
        <tr>
            <td colspan="12" style="background-color: lightblue;"></td>
        </tr>
        <tr id="in_top30_row" style="border: 1px solid;">
            <th style="text-align:left; border: 1px solid;">In Top 30</th>
            {%for user, data in display_dict.user_data.items%}
            <td style="border: 1px solid;">{{data.in_top30}}</td>
            {%endfor%}

        </tr>
        <tr id="outside_top30_row" style="border: 1px solid;">
            <th style="text-align:left; border: 1px solid;">Outside Top 30</th>
            {%for user, data in display_dict.user_data.items%}
            <td style="border: 1px solid;">{{data.outside_top30}}</td>
            {%endfor%}
        </tr>
        <tr id="minus_80_row" style="border: 1px solid;">
            <th style="text-align:left; border: 1px solid;">-80 Picks</th>
            {%for user, data in display_dict.user_data.items%}
            <td style="border: 1px solid;">{{data.minus_80}}</td>
            {%endfor%}
        </tr>
        <tr id="plus_20_row" style="border: 1px solid;">
            <th style="text-align:left; border: 1px solid;">+20 Picks</th>
            {%for user, data in display_dict.user_data.items%}
            <td style="border: 1px solid;">{{data.plus_20}}</td>
            {%endfor%}
        </tr>
        <tr id="at_risk" style="border: 1px solid;">
            <th style="text-align:left; border: 1px solid;">At Risk <span style="font-weight: 100;"> *</span></th>
                {%for user, data in display_dict.user_data.items%}
                <td style="border: 1px solid;">{{data.at_risk}}</td>
                {%endfor%}
        </tr>
        <tr id="onthe_verge" style="border: 1px solid;">
            <th style="text-align:left; border: 1px solid;">On the Verge <span style="font-weight: 100;"> *</span> </th>
                {%for user, data in display_dict.user_data.items%}
                <td style="border: 1px solid;">{{data.onthe_verge}}</td>
                {%endfor%}
        </tr>
        <tr>
            <td colspan="12" style="background-color: lightblue;"></td>
        </tr>
        <tr id="into_top30" style="border: 1px solid;">
            <th style="text-align:left; border: 1px solid;">Moves into Top30</th>
            {%for k, v in display_dict.into_top30.items%}
            <tr>
            <td style="border: 1px solid;">{{k}}</td>
            {%for u, d in v.picks.items%}
                {%if d%}
                <td style="color:green; font-weight: bold;">O</td>
                {%else%}
                <td></td>
                {%endif%}
            {%endfor%}
            </tr>
            {%endfor%}
    
        </tr>
        <tr id="out_top30" style="border: 1px solid;">
        <th style="text-align:left; border: 1px solid;">Moves out of Top30</th>
        {%for k, v in display_dict.out_top30.items%}
        <tr>
        <td style="border: 1px solid;">{{k}}</td>
        {%for u, d in v.picks.items%}
            {%if d%}
                <td style="color: red; font-weight: bold;">X</td>
            {%else%}
                <td></td>
            {%endif%}
        {%endfor%}
    </tr>
        {%endfor%}
    </tr>

</table>
<br>
<h5>Legend:</h5>
<ul>
    <li>At Risk - golfers ranked 20-30 in the FedEx</li>
    <li>On the Verge - golfers ranked 31 - 75 in the FedEx</li>

</ul>
</div>

<div id="detail_div" class="col">
    <h5 style="text-align:center;">Detail</h5>
    <table id="detail-table" class="table table-sm" style="border: 1px solid;">
        <thead>
            <tr style="background-color: lightgray;">
                <th style="border: 1px solid;">Golfer</th>
                <th style="border: 1px solid;">FedEx Rank</th>
                <th style="border: 1px solid;">SOY OWGR</th>
                {%for k, v in display_dict.user_data.items%}
                    <th style="border: 1px solid;">{{k|slice:"0:4"}}</th>
                {%endfor%}
            </tr>
        </thead>
        {%for golfer, data in display_dict.details.items%}
            <tr>
                <td style="font-weight: bold; border: 1px solid;">{{golfer}}</td>
                <td style="border: 1px solid;">{{data.rank}}</td>
                <td style="border: 1px solid;">{{data.soy_owgr}}</td>
                {%for u, score in data.user_dict.items%}
                    {%if score == -30%}
                    <td style="color: blue; border: 1px solid;">{{score}}</td>
                    {%elif score == -80%}
                    <td style="color: green; border: 1px solid;">{{score}}</td>
                    {%elif score == 20%}
                    <td style="color: red; border: 1px solid;">{{score}}</td>
                    {%else%}
                    <td style="border: 1px solid;">{{score}}</td>
                    {%endif%}
                    
                {%endfor%}
            </tr>
        {%endfor%}

    </table>
</div>
</div>

{%endblock%}