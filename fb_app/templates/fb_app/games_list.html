{%extends "fb_app/base.html"%}
{%load staticfiles%}
{%load mathfilters%}
{%load static%}
{{form.media.css}}
{%block body_block%}

<script src="{% static "fb_app/js/games_list.js"%}" type="text/javascript" ></script>


{% if form.errors %}
{% for field in form %}
    {% for error in field.errors %}
      <div class="alert alert-danger">
            <strong>{{ error|escape }}</strong>
        </div>
    {% endfor %}
{% endfor %}
{% for error in form.non_field_errors %}
    <div class="alert alert-danger">
        <strong>{{ error|escape }}</strong>
    </div>
{% endfor %}
{% endif %}
{% if message%}
<div class="alert alert-danger">
      <strong>{{ message|escape }}</strong>
  </div>
{%endif%}

<h3 style="background-color:lightblue">Week:  {{week.week}}  {%if week.started%} Week started - no changes {%endif%}</h3>
<div class="row">

<div class="column">

<div class="games">

   <table class='table table-sm game_tbl'>
     <thead>
       <th>Game Day/Time</th>
      <th>Favorite</th>
      <th>Current Line</th>
      <th>Dog</th>
    </thead>
    <tbody id="game_tbl">
      {%for game in games_list%}
      <tr id='game{{forloop.counter}}'>
        <td>{{game.day}} {{game.time}}</td>
        {%if game.fav == game.home%}
        <td id="fav{{forloop.counter}}" >{%if game.fav%} {{game.fav}} {%else%} {{game.home}}{%endif%}</td>
        {%else%}
        <td id="fav{{forloop.counter}}" >{%if game.fav%} {{game.fav | lower}} {%else%} {{game.home}}{%endif%}</td>
        {%endif%}
        <td class="spread"> {{game.spread}} </td>
        {%if game.dog == game.home%}
        <td id="dog{{forloop.counter}}" >{%if game.dog%}{{game.dog}} {%else%} {{game.away}} {%endif%}</td>
        {%else%}
        <td id="dog{{forloop.counter}}" >{%if game.dog%}{{game.dog | lower}} {%else%} {{game.away | lower}} {%endif%}</td>
        {%endif%}
      </tr>

      {%endfor%}
    </tbody>
   </table>
   <h4 class='footnote'>Home team in CAPS</h4>
</div>
</div>

<div class="column">

  <div class="table table-sm">

    <table>
    <thead>
        <th>Pick#</th>
        <th>Pick List</th>
    </thead>
    <tbody id ='pickstbl'>

      {{ form.media.js }}
      <form id="pick_form" method="POST">
        {%csrf_token%}

        {{ form.management_form}}
        {%for pick in form%}
      <tr>
        <td>{{17|sub:forloop.counter}}</td>
        <td id=pick{{17|sub:forloop.counter}}>{{pick.team}} </td>
        <td class="hidden">{{pick.id}}</td>
      </tr>
        {%endfor%}
      </tbody>
  </table>
  {%if not week.started%}
  <button type="submit" onclick="validate()" class="btn btn-primary">Submit Picks</button>
  {%endif%}
</form>
  </div>
</div>
<div>

  <table>
      <tbody id='old_picks'>
        <tr>
        {%for pick in picks_list%}
        <td id=old_pick{{17|sub:forloop.counter}} hidden>{{pick.team.id}}
        </tr>
        {%endfor%}
      </tbody>
  </table>

<table>
  <tbody id='teams'>
    {%for team_id, team_nfl_abbr in teams.items%}
    <tr {{forloop.counter}} hidden>
      <td id='team_id{{forloop.counter}}' hidden>{{team_id}}</td>
      <td id='team_nfl_abbr{{forloop.counter}}' hidden>{{team_nfl_abbr}}</td>
    </tr>
    {%endfor%}
  </tbody>
</table>

</div>

{%endblock%}
